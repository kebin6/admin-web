var w=(e,d,f)=>new Promise((T,h)=>{var g=n=>{try{r(f.next(n))}catch(i){h(i)}},v=n=>{try{r(f.throw(n))}catch(i){h(i)}},r=n=>n.done?T(n.value):Promise.resolve(n.value).then(g,v);r((f=f.apply(e,d)).next())});import{B as J,u as K}from"./useTable-CCLOgsii.js";import{T as Q,B as X,u as Y}from"./useForm-5wnZKxWU.js";import{aq as Z,v as x,ar as ee,_ as oe}from"./entry/index-C41ZFr6n-1718602026943.js";import{u as ae}from"./index-DDf_l8hU.js";import{F as ne,g as te,c as le,s as ie,u as se,d as de,a as F}from"./FileDrawer-D5B-crei.js";import{i as re}from"./index-DFMDnBcl.js";import{O as ce,M as S}from"./antd-BPAr-OsJ.js";import{d as me,f as l,k as t,ab as p,_ as V,$ as ue,a8 as a,a7 as E,G as k,a1 as y,aa as M,a0 as j}from"./vue-BMCEF3Jf.js";import"./index-oRM4bmDd.js";import"./isBoolean-Dou3jA6I.js";import"./index-G5Wa8967.js";import"./useWindowSizeFn-Cczi9si3.js";import"./isDeepEqual-CCjWtLPA.js";import"./isNumber-j3SIk7av.js";import"./index-CrgunjrK.js";import"./object-BY_VTB7H.js";import"./onMountedOrActivated-CPthIpwg.js";import"./sortable.esm-DFFrMEeC.js";import"./index-D93fFNl6.js";import"./copyTextToClipboard-Cxs8Y4LI.js";import"./useSortable-B_A9JW_B.js";import"./index-CqgpaEX_.js";import"./index-9koevRY3.js";import"./fileTag-B4o9ZOqJ.js";import"./ExclamationCircleOutlined-cpSGxMVL.js";const pe=me({name:"FileManagement",components:{BasicTable:J,FileDrawer:ne,Button:Z,TableAction:Q,BasicUpload:X,Image:ce,Modal:S},setup(){const{t:e}=x.useI18n(),{toClipboard:d}=Y(),{createErrorModal:f,createMessage:T}=ee(),h=l(!1),g=l(),[v,{openDrawer:r}]=ae(),[n,{reload:i}]=K({title:e("fms.file.fileList"),api:te,columns:le,formConfig:{labelWidth:120,schemas:ie},useSearchForm:!0,showTableSetting:!0,bordered:!0,clickToRowSelect:!1,showIndexColumn:!1,actionColumn:{width:50,title:e("common.action"),dataIndex:"action",fixed:void 0},rowKey:"id",rowSelection:{type:"checkbox",onChange:(o,u)=>{g.value=o,h.value=o.length>0}}}),D=l(!1),c=l(!1),b=l(!1),R=o=>{D.value=o},s=l(""),m=l(""),L=l(""),N=l(""),U=l("");function P(){r(!0,{isUpdate:!1})}function A(o){return w(this,null,function*(){let u=yield de(o.id,"none"),B=u.type.split("/")[0];if(U.value=o.name+"."+o.path.split(".")[1],B==="image")b.value=!0,s.value=URL.createObjectURL(u);else if(B==="video")c.value=!0,m.value=URL.createObjectURL(u),L.value=o.name;else{const C=document.createElement("a");C.href=URL.createObjectURL(u),C.download=U.value,C.click(),C.remove(),URL.revokeObjectURL(C.href)}})}function $(){const o=document.createElement("a");o.href=m.value,o.download=U.value,o.click(),o.remove(),URL.revokeObjectURL(o.href),I()}function _(){const o=document.createElement("a");o.href=s.value,o.download=U.value,o.click(),o.remove(),URL.revokeObjectURL(o.href),O()}function I(){c.value=!1}function O(){b.value=!1}function q(o){r(!0,{record:o,isUpdate:!0})}function z(o){return w(this,null,function*(){yield F({ids:[o.id]}),i()})}function G(){return w(this,null,function*(){S.confirm({title:e("common.deleteConfirm"),icon:t(re.ExclamationCircleOutlined),onOk(){return w(this,null,function*(){const u=g.value;(yield F({ids:u})).code===0&&(yield i())})},onCancel(){}})})}function W(o){return w(this,null,function*(){try{yield d(o.publicPath),T.success(e("fms.file.copyURLSuccess"))}catch(u){f({title:e("fms.file.copyURLFailed"),content:o.publicPath})}})}function H(){i()}return{t:e,registerTable:n,registerDrawer:v,handleCreate:P,handleEdit:q,handleDelete:z,handleSuccess:H,handleDownload:A,handleChange:o=>{},uploadApi:se,visible:D,videoVisible:c,imageVisible:b,setVisible:R,imagePath:s,videoPath:m,videoTitle:L,imageTitle:N,handleDownloadVideo:$,handleDownloadImage:_,handleCloseVideo:I,handleCloseImage:O,handleCopyToClipboard:W,handleBatchDelete:G,showDeleteButton:h}}}),fe={width:"1280",height:"720",controls:""},he=["src"];function be(e,d,f,T,h,g){const v=p("Button"),r=p("BasicUpload"),n=p("TableAction"),i=p("BasicTable"),D=p("FileDrawer"),c=p("a-button"),b=p("Modal"),R=p("Image");return V(),ue("div",null,[t(i,{onRegister:e.registerTable},{tableTitle:a(()=>[e.showDeleteButton?(V(),E(v,{key:0,type:"primary",danger:"",preIcon:"ant-design:delete-outlined",onClick:e.handleBatchDelete},{default:a(()=>[k(y(e.t("common.delete")),1)]),_:1},8,["onClick"])):M("",!0)]),toolbar:a(()=>[t(r,{maxSize:1e3,maxNumber:10,onChange:e.handleChange,api:e.uploadApi,class:"my-5",accept:["image/*","video/*","audio/*"]},null,8,["onChange","api"])]),bodyCell:a(({column:s,record:m})=>[s.key==="action"?(V(),E(n,{key:0,actions:[{icon:"ant-design:cloud-download-outlined",tooltip:e.t("fms.file.download"),onClick:e.handleDownload.bind(null,m)},{icon:"ant-design:copy-outlined",tooltip:e.t("fms.file.copyURL"),onClick:e.handleCopyToClipboard.bind(null,m)},{icon:"clarity:note-edit-line",onClick:e.handleEdit.bind(null,m)},{icon:"ant-design:delete-outlined",color:"error",popConfirm:{title:e.t("common.deleteConfirm"),placement:"left",confirm:e.handleDelete.bind(null,m)}}]},null,8,["actions"])):M("",!0)]),_:1},8,["onRegister"]),t(D,{onRegister:e.registerDrawer,onSuccess:e.handleSuccess},null,8,["onRegister","onSuccess"]),t(b,{open:e.videoVisible,"onUpdate:open":d[0]||(d[0]=s=>e.videoVisible=s),title:e.videoTitle,width:"80%","wrap-class-name":"full-modal",onOk:e.handleDownloadVideo},{footer:a(()=>[t(c,{key:"back",onClick:e.handleCloseVideo},{default:a(()=>[k(y(e.t("common.closeText")),1)]),_:1},8,["onClick"]),t(c,{key:"download",type:"primary",onClick:e.handleDownloadVideo},{default:a(()=>[k(y(e.t("fms.file.download")),1)]),_:1},8,["onClick"])]),default:a(()=>[j("video",fe,[j("source",{src:e.videoPath,type:"video/mp4"},null,8,he)])]),_:1},8,["open","title","onOk"]),t(b,{open:e.imageVisible,"onUpdate:open":d[1]||(d[1]=s=>e.imageVisible=s),title:e.imageTitle,width:"50%","wrap-class-name":"full-modal",onOk:e.handleDownloadImage},{footer:a(()=>[t(c,{key:"back",onClick:e.handleCloseImage},{default:a(()=>[k(y(e.t("common.closeText")),1)]),_:1},8,["onClick"]),t(c,{key:"download",type:"primary",onClick:e.handleDownloadImage},{default:a(()=>[k(y(e.t("fms.file.download")),1)]),_:1},8,["onClick"])]),default:a(()=>[t(R,{width:"100%",style:{},preview:{visible:e.visible,onVisibleChange:e.setVisible},src:e.imagePath},null,8,["preview","src"])]),_:1},8,["open","title","onOk"])])}const ze=oe(pe,[["render",be]]);export{ze as default};
